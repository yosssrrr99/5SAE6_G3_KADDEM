pipeline{
    agent any

    options{
        buildDiscarder(logRotator( numToKeepStr: '5'))
    }

    stages{
        stage('Scan'){
            steps{
                withSonarQubeEnv(installationName: 'sq1' ){
                    sh 'mvn clean compile sonar:sonar '
                }
            }
        }
        stage('Nexus build mvn'){
            steps{
                script {
                    withCredentials([usernamePassword(credentialsId: 'nexus-cred', usernameVariable: 'admin', passwordVariable: 'nexus')]) {
                        sh "mvn install -DskipTests "
                        sh "mvn deploy"
                    }
                }
            }
        }
    }

}